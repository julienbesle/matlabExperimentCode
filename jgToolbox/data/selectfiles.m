function [files,folder] = selectfiles(wildcard,prompt,nfiles)% function [files,folder] = selectfiles(wildcard,prompt,nfiles)%% GUI file selection dialog that allows user to select % files within a directory. user can change directories% but can only select files within 1 folder.% selected file names and their folder are retured.% 'files' is a cell array with file names selected% 'folder' is a string of the directory%% use the 'shift' key to select files within a section% use the 'command' key to select multiple files that% are not next to each other on the file list.%% March 6, 2000  JMG% March 15, 2000 -- included wildcard to constrain search (JMG)% March 15, 2000 -- included prompt string (JMG)% get the desktop folder namedefarg('wildcard','*')defarg('prompt','Select All Files:');defarg('nfiles','multiple');if isempty(findstr('*',wildcard)),	wildcard = ['*',wildcard];endif ~strcmp(nfiles,'single'),	nfiles = 'multiple';endlocaldir = pwd;desk = localdir;deskseplocs = find(filesep==pwd);desk = [desk(1:deskseplocs(1)),'Desktop Folder:'];% get selected filescurrisdir = 1;while currisdir		% get currect directory information	currdirs = dir('*');	currdirnames = {currdirs.name};	tempcurrisdir={currdirs.isdir};		dirs = {};	tempdir = {};	isadir = {};	for i = 1:length(tempcurrisdir),		if tempcurrisdir{i}			dirs = {dirs{:},currdirnames{i}};			tempdir = {tempdir{:},1};		end	end		currfiles = dir(wildcard);	if ~isempty(tempdir),		tempfilenames = {currfiles.name};		tempisadir = {currfiles.isdir};		filenames = {};		for i = 1:length(tempisadir),			if ~tempisadir{i}				filenames = {filenames{:},tempfilenames{i}};				tempdir = {tempdir{:},0};			end		end			filenames = {dirs{:},filenames{:}};		isadir = tempdir;	else		filenames = {currfiles.name};		isadir = {currfiles.isdir};	end		folderseplocs = find(filesep==pwd);		% include above directory and desktop folder	folder = pwd;	if length(folderseplocs) > 1		abovedir = folder(1:folderseplocs(end-1));		filenames = {abovedir,filenames{:}};		isadir = {1,isadir{:}};	end	filenames = {desk,filenames{:}};	isadir = {1,isadir{:}};	newfiles = cell2struct(filenames,'name',1);	isdirlocs = find([isadir{:}]==1);		% prompt user for files	dialoglengthP = length(filenames)*15;	[files,ok] = dolistdlg(newfiles,'name',prompt,[300 dialoglengthP],nfiles);	% cancelled ?	if ~ok		files = 0;		return;	else		% look for directories		selectring = [files{:}];		found = 0;		for i = 1:length(isdirlocs)			if findstr(filenames{isdirlocs(i)},selectring) & strcmp(filenames{isdirlocs(i)},selectring)				cd(filenames{isdirlocs(i)});				found = 1;				break;			end		end		if ~found			currisdir = 0;		end	endendreturn