function [rsquare,m,b,mint,bint,F,Fstat] = regression(x,y,showstats)% function [rsquare,m,b,mint,bint,F,Fstat] = regression(x,y,showstats)%% Performs regression of y upon x, and returns rsquared and F statisitics,% as well as the coefficients for the regression line parameters.% Returns the values of rsquare, the coefficients (b) and the f-score (F).%% March 30, 1997.   Jason Gold     U of Toronto Vision Lab.defarg('showstats',1);pccon = 0.95;x = x(:);y = y(:);[n,p] = size(x);		% n = number of observations. p = p+1;				% p = number of variables/parameters.x = [ones(n,1),x];		% add a column on ones to the x matrix.dfreg = p-1;			% degrees of freedom for the sum of squares regression.dferr = n-p;			% degrees of freedom for the sum of squares error.df = n-1;				% total degrees of freedom.J = ones(n);			% matrix of ones for finding SSR and SSE.xpx = x'*x;				% values used to find the coefficients.ixpx = inv(xpx);xpy = x'*y;b = ixpx*xpy;bpxpy = b'*x'*y;		% values used to find the sums of squares.ypjy = y'*J*y;ypy = y'*y;SSR = bpxpy - (1/n)*ypjy;	% sums of squares.SSE = ypy-bpxpy;SSTO = ypy-(1/n)*ypjy;MSR = SSR/dfreg;		% mean squares.MSE = SSE/dferr;F = MSR/MSE;			% F-score.Fstat = fpdf(F,dfreg,dferr);	% significancersquare = SSR/SSTO;		% rsquared value.% find confidence interval for slopem = b(2);b = b(1)n=size(x(:),1);stdx=std(x(:));stdy=std(y(:));rxy=m*stdx/stdy;q=( stdy*sqrt(1-rxy^2) )/( stdx*sqrt(n-2) );t=tinv(1-(1-pccon)/2,n-2);mint(1)=m-t*q;mint(2)=m+t*q;% find confidence interval for y-intercept% (This method assumes m and b are independent, which they are not.)meanx=mean(x(:));meany=mean(y(:));ymin=meany-t*(stdy/sqrt(n));ymax=meany+t*(stdy/sqrt(n));bt=[ ymin-meanx*mint(1) ymin-meanx*mint(2) ymax-meanx*mint(1) ymax-meanx*mint(2) ];bint(1)=min(bt);bint(2)=max(bt);% The following just prints out the info in the command window.if showstats,	% clear the screen.	clc;		% Display the x and y matrices.	disp('-----------------Output------------------------------- ');	disp(' ');	disp('x matrix:')	disp('------------------------------------------------ ');	disp(x);	disp(' ');	disp('y matrix:')	disp('------------------------------------------------ ');	disp(y);	disp(' ');	disp('------------------------------------------------ ');	disp('n		p')	disp([num2str(n),'		',num2str(p)]);	disp('------------------------------------------------ ');	disp(' ');	disp(' ');		% Display the values used to get the coefficients & sums of squares.	disp('------------------------------------------------ ');	disp('x''x');	disp('------------------------------------------------ ');	disp(xpx);	disp(' ');	disp('------------------------------------------------ ');	disp('(x''x)^-1');	disp('------------------------------------------------ ');	disp(ixpx);	disp(' ');	disp('------------------------------------------------ ');	disp('x''y');	disp('------------------------------------------------ ');	disp(ypy);	disp(' ');	disp('------------------------------------------------ ');	disp('b''x''y				y''Jy				y''y');	disp([num2str(bpxpy),'			',num2str(ypjy),'			',num2str(ypy)]);	disp('------------------------------------------------ ');	disp(' ');	disp('-----------------Coefficients--------------------- ');	w = 0;	disp(' ');	disp(['slope = ',num2str(m),'  intercept = ',num2str(b)]);	disp('------------------------------------------------ ');		% Display the ANOVA table.	disp(' ');	disp('------------------ANOVA Table--------------------- ');	disp('Source of Var		SS			df			MS			F');	disp('---------------------------------------------------------- ');	disp(['Regression		',num2str(SSR),'		',num2str(dfreg),'		',num2str(MSR),'		',num2str(F)]);	disp(['Error			',num2str(SSE),'		',num2str(dferr),'		',num2str(MSE),]);	disp(['Total			',num2str(SSTO),'		',num2str(df),'		']);	disp('---------------------------------------------------------- ');		% Display the r-squared value.	disp(['R-Squared = ',num2str(rsquare)]);	disp('---------------------------------------------------------- ');endreturn