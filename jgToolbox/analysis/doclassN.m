function [class,classtol,rclass,compositeclass] = doclassN(file,folder,filesuppress,dispsuppress)defarg('folder',pwd);defarg('filesuppress',0);defarg('dispsuppress',0);tol = 1.96; % .05tol = 2.58; % .01%tol = 3;if ~exist('file','var');	[file,folder] = uigetfile('*.dat','Choose File');end% main loopif file		% get the data	data = readdata(file,folder);	period=findstr(file,'.');	if isempty(period)==0,		file=[file(1:period-1),'src.mat'];	end	fprintf(1,['Total trials = ',num2str(size(data,1)),'.\n']);	cd(folder);	eval(['load ',file]);	kernal = [1 2 3 2 1];	kernal = kernal'*kernal;	squarekernal = sqrt(sum(sum(kernal.^2)));	numstd = 6;	% summed noise files are stored in 'src.mat' file	numalt = max(data(:,sequence));	for i = 1:numalt				% make images		eval(['classr',num2str(i),' = zeros(size(s1r1));']);		rvar = zeros(1,numalt);		for j = 1:numalt			eval(['trials.s',num2str(i),'r',num2str(j),' = sum(data(:,sequence)==',num2str(i),' & data(:,response)==',num2str(j),');']);			eval(['vars.s',num2str(i),'r',num2str(j),' = noisevar/trials.s',num2str(i),'r',num2str(j),';']);			eval(['s',num2str(i),'r',num2str(j),' = s',num2str(i),'r',num2str(j),'/trials.s',num2str(i),'r',num2str(j),';']);			eval(['classr',num2str(i),' = classr',num2str(i),' + s',num2str(i),'r',num2str(j),';']);			eval(['rvar(',num2str(i),') = rvar(',num2str(i),') + vars.s',num2str(i),'r',num2str(j),';']);		end		eval(['rawclass',num2str(i),' = classr',num2str(i),';']);		eval(['classr',num2str(i),' = conv2(classr',num2str(i),',kernal,''same'');']);		eval(['classtolr',num2str(i),' = classr',num2str(i),';']);				% threshold		smoothstd = squarekernal*sqrt(rvar(i));		classmaxval = tol*smoothstd;		eval(['tollocs = find(abs(classtolr',num2str(i),')<classmaxval);']);		eval(['postollocs = find(classtolr',num2str(i),'>classmaxval);']);		eval(['negtollocs = find(classtolr',num2str(i),'<-classmaxval);']);		eval(['classtolr',num2str(i),'(tollocs) = .5;']);		eval(['classtolr',num2str(i),'(postollocs) = 1;']);		eval(['classtolr',num2str(i),'(negtollocs) = 0;']);		eval(['classtol.classtolr',num2str(i),' = classtolr',num2str(i),';']);				% scale	 	eval(['classmean = mean(classr',num2str(i),'(:));'])	 	eval(['classstd = std(classr',num2str(i),'(:));']);	 	eval(['classr',num2str(i),' = (classr',num2str(i),'-classmean)./(numstd*classstd) + .5;']); 			eval(['classr',num2str(i),'(find(classr',num2str(i),' > 1)) = 1;']);		eval(['classr',num2str(i),'(find(classr',num2str(i),' < 0)) = 0;']);		eval(['class.classr',num2str(i),' = classr',num2str(i),';']);		eval(['rclass.rawclass',num2str(i),' = rawclass',num2str(i),';']);		% display		eval(['figure; imshow([classr',num2str(i),',classtolr',num2str(i),']);']);		end	% composite image	compositeclass = zeros(size(rawclass1));	for i = 1:numalt		eval(['compositeclass = compositeclass + rawclass',num2str(i),'.^2;']);	end	compositeclass = scale(compositeclass);	figure;imshow(compositeclass);		% save file ?	if ~filesuppress			% write to file		period=findstr(file,'.');		file=file(1:period-4);		[newfile,newfolder] = uiputfile([file,'class.mat'],'Save File As');		if newfile					save([newfolder,newfile],'class','classtol','rclass','compositeclass');		end	end	end