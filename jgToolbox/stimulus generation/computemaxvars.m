function [vmax] = computemaxvars(images,cal)% function [vmax] = computemaxvars(images,cal)%% computes the maximum displayable contrast variances% for a set of images in the struct array IMAGES.% the maximum variance is constrained by the maximum, minimum,% and average luminance of the display. these are stored% in the calibration structure CAL in the field LMAXMINAVE.% (see the function GETDDF for details).%% the maximum variance is the highest variance the image can be% set to before it exceeds the maximum positive or negative contrast% (defined as (lum-lave)/lave).%%  Feb 25, 1999  JMG% first compute the limit. the largest contrast is constrained% by the smaller of the two extremes; i.e., whichever is smaller, the% absolute value of the largest positive or negative contrast.cmax = min(abs([(cal.lmaxminave(1)-cal.lmaxminave(3))/cal.lmaxminave(3),(cal.lmaxminave(2)-cal.lmaxminave(3))/cal.lmaxminave(3)])); % get the names of the imagesnames = fieldnames(images);% adjust each image so that it displays the highest possible contrast.% the calculate the variances of the adjusted images.vmax = zeros(size(names));for i = 1:length(names)		eval(['temp = images.',names{i},'*(cmax/max(max(abs(images.',names{i},'))));']);	vmax(j) = std(temp(:))^2;		endreturn;