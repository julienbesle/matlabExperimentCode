function theimage = threshimage(theimage,pc,lowerval,upperval)% function newimage = threshimage(theimage,pc)%% sets the top [pc] percent of the pixels in an image to % one and the lower [1-pc] percent of the pixels to zero.% this is usually used as a filter to remove various% percentages of pixels from an image.defarg('pc',2.5);defarg('lowerval',0);defarg('upperval',1);if pc < 100	pc = pc/100;	if pc > 0		% transform to a vector for sorting		msz = size(theimage);		vimage = theimage(:);		[simage,index] = sort(vimage);		vsz = length(vimage);		% the location that borders the top [pc] percent of pixels		pcloc = round((1-pc)*vsz);		lowerindex = index(1:pcloc-1);		upperindex = index(pcloc:end);		% set the upper part to ones, lower part to zeros		vimage(lowerindex) = ones(size(lowerindex))*lowerval;		vimage(upperindex) = ones(size(upperindex))*upperval;		% reconstruct the original matrix		theimage = reshape(vimage,msz(1),msz(2));	else		theimage = ones(size(theimage))*lowerval;	endelse	theimage = ones(size(theimage))*nan;endreturn