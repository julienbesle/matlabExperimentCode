function newsrc = telltrial( trialsrc, level, success )% TELLTRIAL  Report result of a trial to a trial source.%% newsrc = telltrial( trialsrc, level, success )% 28-Jan-98 -- created (RFM)switch lower(trialsrc.type)	case 'constim',		% response has no effect	case 'quest',				% update posterior pdf		if success,			trialsrc.pdf=trialsrc.pdf.*trialsrc.successfn(level,trialsrc.levels);		else			trialsrc.pdf=trialsrc.pdf.*(1-trialsrc.successfn(level,trialsrc.levels));		end		trialsrc.pdf=trialsrc.pdf/sum(trialsrc.pdf);				% determine whether desired level of certainty has been reached		cdf=pdf2cdf([ trialsrc.levels' trialsrc.pdf' ]);		cdf=cdf(:,2)';		range=trialsrc.levels(min(find(cdf>=0.975))) - ...			trialsrc.levels(max(find(cdf<=0.025)));		if range<trialsrc.interval,			[ m i ] = max(trialsrc.pdf);			trialsrc.final=trialsrc.levels(i);		end			case 'pquest',		trialsrc.q=questupdate(trialsrc.q,log10(level),success);		if 10^(questsd(trialsrc.q))<trialsrc.finalsd,			trialsrc.final=10^questquantile(trialsrc.q);		end	case 'udtr',		if success,			trialsrc.correct=trialsrc.correct+1;			if trialsrc.correct>=trialsrc.correctmax,				trialsrc.leveli=max(1,trialsrc.leveli-1);				trialsrc.correct=0;				trialsrc.incorrect=0;			end		else			trialsrc.incorrect=trialsrc.incorrect+1;			if trialsrc.incorrect>=trialsrc.incorrectmax,				trialsrc.leveli=min(size(trialsrc.levels,2),trialsrc.leveli+1);				trialsrc.correct=0;				trialsrc.incorrect=0;			end		end	case 'series',		% response has no effect	case 'list',		% send response to last member polled		if isempty( trialsrc.prevsource )==1,			error('No trial source to report to.');		else			trialsrc.sources{trialsrc.prevsource} = ...				telltrial( trialsrc.sources{trialsrc.prevsource}, level, success );			trialsrc.prevsource=[];		end	otherwise		error(sprintf('Unknown trial source type ''%s''.',trialsrc.type));endnewsrc=trialsrc;return