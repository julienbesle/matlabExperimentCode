function [m] = avemag(m,c)% function [m] = avemag(m,c)%% make stimuli with an averaged magnitude spectrum.% DC component is set to zero (averge luminance).% m is a struct array with the stimuli, all the % same size. %% c the contrast variance to which the images should be set.% if it is not passed, the contrast is not altered.%% March 3 1999   JMGnames = fieldnames(m);n = length(names);eval(['mag = zeros(size(m.',names{1},'));']);for i = 1:n	eval(['ft = fft2(m.',names{i},');']);	eval(['s.',names{i},'= angle(ft);']);	mag = mag+abs(ft);endmag = mag./n;% the next line sets DC to zero. Jason's faces used this line:% mag(1,1) = 0;% However, for ZH's stimuli, where we are creating a new set from% Jason's faces and Daphne's faces, we are NOT going to set DC to zerofor i = 1:n	eval(['m.',names{i},'= real(ifft2(mag.*exp(j*s.',names{i},')));']);end% change contrastif exist('c','var')	for i = 1:n		eval(['m.',names{i},'= m.',names{i},'*sqrt(c/std(m.',names{i},'(:))^2);']);	endendreturn;