function [clut] = makeQTmovie(frames,rate,fname,convert,clut,cal)% function [clut] = makeQTmovie(frames,rate,fname,convert,cal,clut)%% wrapper around matlab's quicktime movie writing function 'QTwrite'.%% 'frames'	-	a three dimensional matrix of images, with the third%				dimension being the frames of the movie. i have to test%				this more, but I think QTwrite does not handle odd numbers%				of frames. % 'rate'	-	the frame rate of the movie, in frames/second. default is 24.% 'fname'	-	the name of the movie file to be written. the extension%				'.mov' is added if it is not present already. default%				filename is 'qtmovie'.% 'cal'		-	OPTIONAL argument, a calibration file structure from 'getddf'.%				QTwrite requires a clut, so this is used to generate one.%				the clut is returned so that mutiple movies may be%				made with the same clut (see 'clut' below). if 'cal' is not%				passed, a lnearly spaced clut that covers the range of values%				in the images is used.% 'clut'	-	OPTIONAL argument, a [256x3] matrix to be used as the%				colormap for the movie. this is useful if the movie is%				large and must be broken down into several smaller movies.%% October 10/11, 1998	J Gold% as of october 11:  'cal' must be supplied defarg('clut',[]);defarg('fname','qtmovie.mov');defarg('rate','24');defarg('convert',1);options = [rate,2,6];if length(size(frames))==3 & nargin > 1	% add '.mov' extension if it is not already there	ext = findstr('.mov',fname);	if isempty(ext)		fname = [fname,'.mov'];	end	if convert & ~isempty(clut)				% convert the entire movie matrix into an indexed image matrix w/clut		if exist('cal','var')					% use the function 'makeimage' if a cal structure was supplied			[frames,tempclut] = makeimage(frames,cal);		else			% otherwise, make a linearly spaced clut			tempclut = linspace(0,1,256);			[themax,themin] = maxmin(frames);			slope = 256/(themax-themin);							intercept = 256 - slope*themax;								frames = round(frames.*slope + intercept);		end			% if clut was not passed, use the one just generated.		if isempty(clut)			clut = (tempclut(:,1)./max(max(tempclut(:,1))))*[1 1 1];		end			end	% scale clut between 0-1 if not done already.	if max(max(clut)) > 1		clut = (clut(:,1)./max(max(clut(:,1))))*[1 1 1];	end		% save the movie		qtwrite(frames,size(frames),clut,fname,options);endreturn