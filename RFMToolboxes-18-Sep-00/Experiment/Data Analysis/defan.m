function thresh = defan( subject, stimcolname, corrcolname, blockfilter, trialfilter, pool )% DEFAN  Default datafile analysis routine%% thresh = defan( subject, stimcolname, corrcolname, blockfilter, trialfilter, pool )% 21-Aug-98 -- created (RFM)% set default argumentsdefarg('stimcolname','STIMULUS');defarg('corrcolname','CORRECT');defarg('blockfilter','');defarg('trialfilter','');defarg('pool',0);% type of fit to usetype='weibull';% read data	data=dfread(datafname(subject));SN=size(data,2);% collapse across blocks, and analyze as one datasetif pool,	d=[];	for i=1:SN,		eval(data{i}.cmd);		if isempty(blockfilter) | (eval(blockfilter)==1),			d=[ d ; data{i}.lines ];			c=data{i}.cmd;		end;	end	clear data;	data{1}.lines=d;	data{1}.cmd=c;	SN=1;end% step through sessionsthresh=[];for s=1:SN;	% evaluate session commands	eval(data{s}.cmd);		% filter blocks	if pool | isempty(blockfilter) | (eval(blockfilter)==1),		% filter trials		lines=data{s}.lines;		if ~isempty(trialfilter),			lines=lines(eval(trialfilter),:);		end			% analyze		trials=lines(:,[ eval(stimcolname) eval(corrcolname) ]);		emp=emppsymet(trials);		[ p1 p2 ]=fitpsymet(trials,type);		thresh=[ thresh ; getthresh(0.75,type,[ p1 p2 ]) ];		% report		if SN>1,			fprintf(1,'session %d  ',s);		end		fprintf(1,'75%% threshold:  %.2f (%.2f, %.2f)\n',thresh(end),p1,p2);		figure;		plotpsymet(emp,type,[ p1 p2 ]);		title(sprintf('Session %d',prod(size(thresh))));		drawnow;			end	end% mean thresholdif SN>1,	fprintf(1,'mean 75%% threshold:  %.2f\n',mean(thresh));end% suppress return argumentif nargout==0,	clear thresh;endreturn