function fn = emppsymet( trials, mintrials, pooled )% EMPPSYMET - Empirical psychometric function%% fn = emppsymet( trials, mintrials, pooled )%% Returns matrix with rows of form [ level proportion_correct ntrials stderr ]% late 96   -- created (RFM)% 21-Jul-98 -- option to pool added (RFM)defarg('mintrials',0);defarg('pooled',0);if ~pooled,	% get list of stimulus level used	stimlevs=unique(trials(:,1))';		% get row of empirical psychometric function matrix for each stimulus level	fn=[];	for s=stimlevs,		c=trials(find(trials(:,1)==s),2); % correct flags		n=size(c,1);                      % trial count		p=sum(c)/n;                       % proportion correct		e=sqrt(p*(1-p)/n);                % standard error of proportion correct		fn=[ fn ; s p n e ];	endelse	% pick bins	meanlev=mean(trials(:,1));	stdlev=std(trials(:,1));	minlev=max(min(trials(:,1)),meanlev-2*stdlev);	maxlev=min(max(trials(:,1)),meanlev+2*stdlev);	bins=linspace(minlev,maxlev,7);		% correct trials in each bin	ctrials=trials(find(trials(:,2)==1),1);	ccount=hist(ctrials,bins);		% incorrect trials in each bin	itrials=trials(find(trials(:,2)==0),1);	icount=hist(itrials,bins);	% total trials in each bin	n=ccount+icount;		% proportion correct in each bin	p=ccount./n;	% standard error of each bin	e=p.*(1-p)./sqrt(n);		% put together empirical psychometric function matrix	fn=[ bins' p' n' e' ];end% delete levels with too few trialsfn=fn(fn(:,3)>=mintrials,:);return