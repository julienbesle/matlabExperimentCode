function occfigmat( reel, fig, mask, theta, ...	radiusP, cycperiodF, phi0, ...	occsizeP, occdispP, gapsizeP, ...	bglum, occlum, occsolid, noisestd )% OCCFIGMAT  Make occluded figure display%% occfigmat( reel, fig, mask, theta, radiusP, cycperiodF, phi0, ...%     occsizeP, occdispP, gapsizeP, bglum, occlum, occsolid, noisestd )% 23-Oct-98 -- created (RFM)% 18-Apr-99 -- modified for use with od.m (RFM)% 26-Apr-99 -- created;  adapted from odr.m (RFM)% get movie parametersF=reel.nframes;                % number of frames in movieframesizeP=reel.framesize(1);  % display size (assumed square)frameMid=rectmid(reel.view);   % centre of frame% write figure to offscreen window[ FM, FN ]=size(fig);figRect=[ 0 0 FN-1 FM-1 ];% find top left-hand corner of centred figurefigrect=centrerect(reel.view,figRect);FX0=figrect(1);FY0=figrect(2);% determine occluder regionsocc=centrerect(reel.view,[ 0 0 occsizeP occsizeP ]);shiftd=0.5*(occsizeP+gapsizeP);occRect{1}=shiftrect(occ,-shiftd,-shiftd);occRect{2}=shiftrect(occ,+shiftd,-shiftd);occRect{3}=shiftrect(occ,+shiftd,+shiftd);occRect{4}=shiftrect(occ,-shiftd,+shiftd);occDisp{1}=shiftrect(occRect{1},-occdispP,-occdispP);occDisp{2}=shiftrect(occRect{2},+occdispP,-occdispP);occDisp{3}=shiftrect(occRect{3},+occdispP,+occdispP);occDisp{4}=shiftrect(occRect{4},-occdispP,+occdispP);% get fixation point positionfixRect=centrerect(reel.view,[ 0 0 3 3 ]);global framematif isempty(framemat),	framemat=zeros(reel.view(4),reel.view(3));endglobal firstdrawFN=ifso(isempty(firstdraw),F,F-2);firstdraw=0;% draw each framefor f=1:FN,	% clear frame	framemat(:)=bglum;	if f<=(F-2),		% get position for this frame		phi=(360*(f-1)/cycperiodF)+phi0;		FX=FX0+radiusP*dcos(phi);		FY=FY0-radiusP*dsin(phi);		destRect=round(shiftrect(figRect,FX,FY));		% draw figure to frame		framemat(destRect(2):destRect(4),destRect(1):destRect(3))=fig;	end	% draw occluders	for i=1:4,		if occsolid,			destRect=occRect{i};			framemat(destRect(2):destRect(4),destRect(1):destRect(3))=bglum;		end		destRect=occDisp{i};		t=2;		framemat(destRect(2):(destRect(2)+(t-1)),destRect(1):destRect(3))=occlum;		framemat((destRect(4)-(t-1)):destRect(4),destRect(1):destRect(3))=occlum;		framemat(destRect(2):destRect(4),destRect(1):(destRect(1)+(t-1)))=occlum;		framemat(destRect(2):destRect(4),(destRect(3)-(t-1)):destRect(3))=occlum;	end	% draw fixation point	framemat(fixRect(2):fixRect(4),fixRect(1):fixRect(3))=50;	% add noise	if (noisestd>0) & (f<=F-2),		noisemat=random('norm',0,noisestd,framesizeP,framesizeP);		noisemat(:)=bglum*max(min(noisemat(:),.8),-.8);%		hist(noisemat(:)); drawnow;		framemat=framemat+bglum*random('norm',0,noisestd,framesizeP,framesizeP);	end	% write matrix to window		framemat=lum2rgb(framemat);	screen(reel.frameID(f),'PutImage',framemat,reel.view,'srcCopyQuickly');end% draw post-mask on second-last frameif mask=='w',	d=290;	maskRect=centrerect(reel.view,[ 0 0 d d ]);	screen(reel.frameID(F-1),'PutImage',lum2rgb(random('norm',35,10,d,d)),maskRect,'srcCopyQuickly');endreturn