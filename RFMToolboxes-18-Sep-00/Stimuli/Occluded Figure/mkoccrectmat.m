function framemat = mkoccrectmat( n, bglum, rectwidthP, rectheightP, rectthickP, rectlum, occsizeP, gapsizeP, occdispP, occlum )% MKOCCRECTMAT  Make an occluded rectangle display%% framemat = mkoccrectmat( n, rectwidthP, rectheightP, occsizeP, gapsizeP )% 25-Sep-99 -- created;  adapted from occfigmat.mdefarg('n',180);defarg('bglum',30);defarg('rectwidthP',105);defarg('rectheightP',100);defarg('rectthickP',5);defarg('rectlum',40);defarg('occsizeP',50);defarg('gapsizeP',50);defarg('occdispP',0);defarg('occlum',20);bglum=140;rectlum=255;occlum=50;% initialize image matrixframemat=bglum*ones(n);frameRect=[ 0 0 n n ];% make figurerectcst=(rectlum-bglum)/bglum;fig=bglum*(1+rectcst*mkrect(rectwidthP,rectheightP,rectthickP));[ FM, FN ]=size(fig);figRect=[ 0 0 FN-1 FM-1 ];% find position of centred figurefigPos=centrerect(frameRect,figRect);% determine occluder regionsocc=centrerect(frameRect,[ 0 0 occsizeP occsizeP ]);shiftd=0.5*(occsizeP+gapsizeP);occRect{1}=shiftrect(occ,-shiftd,-shiftd);occRect{2}=shiftrect(occ,+shiftd,-shiftd);occRect{3}=shiftrect(occ,+shiftd,+shiftd);occRect{4}=shiftrect(occ,-shiftd,+shiftd);occDisp{1}=shiftrect(occRect{1},-occdispP,-occdispP);occDisp{2}=shiftrect(occRect{2},+occdispP,-occdispP);occDisp{3}=shiftrect(occRect{3},+occdispP,+occdispP);occDisp{4}=shiftrect(occRect{4},-occdispP,+occdispP);% get position for this frame%phi=(360*(f-1)/cycperiodF)+phi0;%DX=radiusP*dcos(phi);%DY=radiusP*dsin(phi);DX=0;DY=0;destRect=round(shiftrect(figPos,DX,DY));% draw figure to frameframemat(destRect(2):destRect(4),destRect(1):destRect(3))=fig;% draw occludersoccsolid=1;for i=1:4,	if occsolid,		destRect=round(occRect{i});		framemat(destRect(2):destRect(4),destRect(1):destRect(3))=bglum;	end	destRect=round(occDisp{i});	framemat(destRect(2):destRect(4),destRect(1):destRect(3))=occlum;end% draw fixation pointfixRect=round(centrerect(frameRect,[ 0 0 3 3 ]));framemat(fixRect(2):fixRect(4),fixRect(1):fixRect(3))=rectlum;% framemat=imrotate(framemat,45);% % imagesc(framemat); colormap gray; axis image; axis off;% % clear framemat% w=screen(0,'OpenWindow',0);% clut=[ 140 1:255 ]'*ones(1,3);% screen(0,'SetClut',clut);% screen(w,'PutImage',framemat);% pause;% clreturn