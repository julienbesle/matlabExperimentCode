function [ dprimea, s, dprime ] = sdtrate( ratemat, gflag )% SDTRATE  Signal detection statistics for a rating task%% [ dprimea, s, dprime ] = sdtrate( ratemat, gflag )% 05-Oct-98 -- created (RFM)% set default argumentsdefarg('gflag',0);% number of rating categoriesr=size(ratemat,2);% proportion of responses within each rowpmat = ratemat./(sum(ratemat')'*ones(1,r));% cumulative proportions within each rowcmat=zeros(2,r);cmat(:,1)=pmat(:,1);for i=2:r,	cmat(:,i)=cmat(:,i-1)+pmat(:,i);end% z-score of each cumulative proportionzmat=z(cmat(:,1:r-1));% sensitivity on each rating conditiondprime=zmat(1,:)-zmat(2,:);% linear fitfitfn=inline('p(1)+p(2)*x','x','p');f=fit(fitfn,[ zmat(2,:) ; zmat(1,:) ],[ 1 1 ],'ss');dprime2=f(1)s=f(2);% rating-scale sensitivitydprimea=sqrt(2/(1+s^2))*dprime2;% plotif gflag~=0,	plotroc(cmat(:,1:r-1),0,1);endreturn% inverse cumulative normal with mean=0.0, std=1.0function r = z( p )r=norminv(p,0,1);return