/*sine2d.c -- make a 2D sinewave gratingMATLAB usage:  sinemat = sine2d( dim, lambda, theta, phi, mean, contrast )14/11/97 -- created (RFM)*/#include "mex.h"#include <math.h>/* prototypes */mxArray *sine2d(int M,int N,double fLambda, double fTheta, double fPhi,	double fMean, double fContrast);/* gateway function */void mexFunction(int nlhs,mxArray *plhs[],int nrhs,const mxArray *prhs[]) {	/* check number and type of arguments */	/* parameters */	int M,N;	double fLambda, fTheta=0, fPhi=0, fMean=0, fContrast=1;	double *pDim;		/* get matrix size */	pDim = mxGetPr(prhs[0]);	M=(int)*pDim;	N=( mxGetM(prhs[0])>1 ? (int)*(pDim+1): M );	fLambda = mxGetScalar(prhs[1]);	if( nrhs>=3 )		fTheta=mxGetScalar(prhs[2]);	if( nrhs>=4 )		fPhi=mxGetScalar(prhs[3]);	if( nrhs>=5 )		fMean=mxGetScalar(prhs[4]);	if( nrhs>=6 )		fContrast=mxGetScalar(prhs[5]);	plhs[0] = sine2d(M,N,fLambda,fTheta,fPhi,fMean,fContrast);	return;		}/* core routines */mxArray *sine2d(int M,int N,double fLambda, double fTheta, double fPhi,	double fMean, double fContrast) {	int i,j;	int i0=ceil(M/2),j0=ceil(N/2);	int nColOffset;		double k = 2*pi/fLambda;	double kx = k*cos(fTheta), ky=k*sin(fTheta);	double kxrx_phi;	double fScale = ( fMean==0 ? fContrast : fMean*fContrast );		mxArray *pSineArr = mxCreateDoubleMatrix(M,N,mxREAL);	double *pSineMat = mxGetPr(pSineArr);		for(j=0;j<N;j++) {		kxrx_phi = kx*(j-j0)-fPhi;		nColOffset=j*M;		for(i=0;i<M;i++)			*(pSineMat+i+nColOffset)=fMean+fScale*sin(ky*(i0-i)+kxrx_phi);		}		return( pSineArr );	}