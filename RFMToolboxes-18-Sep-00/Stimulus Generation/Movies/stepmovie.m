function stepmovie( reel, ipf )% STEPMOVIE  Allow user to step through a movie frame-by-frame%% stepmovie( reel, ipf )%% KEYS:%      up-arrow    = previous frame%      down-arrow  = next frame%      right-arrow = play movie%      home        = first frame%      end         = last frame%      return      = quit% 24-Mar-98 -- created (RFM)defarg('ipf',1);% decide on background colourglobal sgBGColour;bg = notnull( sgBGColour, 0 );load keys% step through framesf=1;of=0;while 1,	if f~=of,		screen(reel.destID,'WaitVBL');		screen('CopyWindow',reel.frameID(f),reel.destID,reel.view,reel.destView);	end	key=getvalidkey( [ KEY_UPARROW KEY_DOWNARROW KEY_RIGHTARROW KEY_HOME KEY_END KEY_RETURN ] );	of=f;	switch key,		case KEY_UPARROW,    f=max(f-1,1);		case KEY_DOWNARROW,  f=min(f+1,reel.nframes);		case KEY_RIGHTARROW,			cls(reel.destID); pausems(500); playmovie(reel,ipf); pausems(500); of=-1;		case KEY_HOME, f=1;		case KEY_END,  f=reel.nframes;		case KEY_RETURN, break	endend% clear movie screenscreen(reel.destID,'FillRect',bg,reel.destView);return