function rgb = lum2rgb( lum )% LUM2RGB  Convert luminances (cd/m^2) to RGB values%% rgb = lum2rgb( lum )% 16-Apr-98 -- created (RFM)% 14-Apr-98 -- support created for multiple monitors (RFM)% 24-Aug-99 -- adapted for bit-stealing clut (RFM)% % assumes R=0.5, G=0.3, B=0.2% off=[ 0 0 0 ;  % 0.0%       0 0 1 ;  % 0.1% 	  0 0 1 ;  % 0.2% 	  0 1 0 ;  % 0.3% 	  0 1 1 ;  % 0.4% 	  1 0 0 ;  % 0.5% 	  1 0 1 ;  % 0.6% 	  1 0 1 ;  % 0.7% 	  1 1 0 ;  % 0.8% 	  1 1 1 ;  % 0.9% 	  1 1 1 ];  % 1.0% assumes R=0.3, G=0.6, B=0.1off=[ 0 0 0 ; % 0.00 - 0.05      0 0 1 ; % 0.05 - 0.10	  0 0 1 ; % 0.10      0 0 1 ; % 0.15      1 0 0 ; % 0.20      1 0 0 ; % 0.25      1 0 0 ; % 0.30      1 0 1 ; % 0.35      1 0 1 ; % 0.40      1 0 1 ; % 0.45      0 1 0 ; % 0.50      0 1 0 ; % 0.55      0 1 0 ; % 0.60      0 1 1 ; % 0.65      0 1 1 ; % 0.70      0 1 1 ; % 0.75      1 1 0 ; % 0.80      1 1 0 ; % 0.85      1 1 0 ; % 0.90      1 1 1 ]; % 0.95global ENVIRONif isempty(ENVIRON),	error('Stimulus generation toolbox must be initialized with ''setenv.m''');else	lum=lum(:);	grey=lum2grey(lum+1e-6,0);	rgb=floor(grey)*ones(1,3);	lum0=grey2lum(rgb(:,1));	lum1=grey2lum(rgb(:,1)+1);	p=floor(20*(lum-lum0)./(lum1-lum0))+1;	rgb=rgb+off(p,:);endreturn