cd(matdatadir);dt=dir; tmp=size(dt); kk=tmp(1);found=1;k=1;while found	matfname=['grp',num2str(groupID),'_',exptname,'_ID',sidnum,'_N',num2str(k)];	testname=[matfname,'.mat'];	tmp=0;	for n=1:kk		tmp(n)=strcmp(lower(testname),lower(dt(n).name));	end;	found=max(tmp);	k=k+1;end;thedate=date;save(matfname); % save everything to a mat filedisp(['workspace stored in file ',testname]);cd(mainpath);cd(textdatadir);textfname=['grp',num2str(groupID),'_',exptname,'_ID',sidnum];testname=[textfname,'.txt'];datafilename=testname;fid=fopen(datafilename,'a');count=fprintf(fid,'%s\n',['Date: ',thedate]);count=fprintf(fid,'%s\n',['File: ',datafilename]);count=fprintf(fid,'%s\n',['Experiment: ',exptname]);count=fprintf(fid,'%s\n',['Subject ID: ',sidnum]);count=fprintf(fid,'%s\n',['Gender: ',sgender]);count=fprintf(fid,'%s\n',['Age: ',num2str(sage)]);count=fprintf(fid,'%s\n',['Group ',num2str(groupID)]);count=fprintf(fid,'%s\n',['Comment: ',scomment]);count=fprintf(fid,'%s\n',['Calibration File: ',calfile]);count=fprintf(fid,'%s\n',['Avg Luminance: ',num2str(cal.lmaxminave(3))]);count=fprintf(fid,'%s\n',['Display Frame Rate (Hz): ',num2str(displayrate)]);count=fprintf(fid,'%s \t %s \t %s\n','Display Size (pixels): ',['Width: ',num2str(scrinfo.width)],['Height: ',num2str(scrinfo.height)]);count=fprintf(fid,'%s\n',['Display set to ',num2str(scrinfo.pixelSize),' bits per pixel']);count=fprintf(fid,'%s\n',['Cue Duration (sec): ',num2str(exptdesign.cueduration)]);count=fprintf(fid,'%s\n',['Cue Offset (sec): ',num2str(exptdesign.cueoffset)]);count=fprintf(fid,'%s\n',['Stimulus duration (sec): ',num2str(exptdesign.duration)]);count=fprintf(fid,'%s\n',['ISI (sec): ',num2str(exptdesign.isi)]);count=fprintf(fid,'%s\n',['Inter-trial interval (sec):',num2str(exptdesign.intertrial)]);count=fprintf(fid,'%s\n',['Light Adaptation Duration (sec):',num2str(exptdesign.adaptseconds)]);count=fprintf(fid,'%s\n',['Viewing distance (cm):',num2str(exptdesign.viewingdistcm)]);count=fprintf(fid,'%s\n',['# of external noise levels:',num2str(exptdesign.numnz)]);count=fprintf(fid,'%s\n',['external noise levels:',num2str(nv)]);count=fprintf(fid,'%s\n',['# of stimulus locations:',num2str(exptdesign.numlocs)]);count=fprintf(fid,'%s\n',['Cued Set Size: ',num2str(exptdesign.cuedsetsize)]);count=fprintf(fid,'%s\n',['Stimulus Eccentricity (pixels): ',num2str(exptdesign.stimeccentricity)]);count=fprintf(fid,'%s\n',['Stimulus Direction (deg): ',num2str(exptdesign.targlocsdeg)]);count=fprintf(fid,'%s\n',['Take break after trial # ',num2str(exptdesign.takebreaktrial)]);count=fprintf(fid,'%s\n',['Minimum reversals needed for threshold: ',num2str(exptdesign.minreversals)]);count=fprintf(fid,'%s\n',['Stimulus frequency bandwidth (inclusive; cycles per image):',num2str(lowf),' - ',num2str(highf)]);count=fprintf(fid,'%s\n',['Stimulus orientation bandwidth (inclusive; deg; horizontal is 0 deg):',num2str(otarget(1)),' - ',num2str(otarget(2))]);count=fprintf(fid,'%s\n',['Target rotation (deg):',num2str(odelta(1))]);count=fprintf(fid,'%s\n',['Distractor rotations (deg):',num2str(odelta(2)),' & ',num2str(odelta(3))]);count=fprintf(fid,'%s\n',['Size of stimulus array (pixels):',num2str(stimpix)]);count=fprintf(fid,'%s\n\n',['Matlab workspace stored in file: ',matfname]);tmp=log10(stimvariance(2)/stimvariance(1));tmpa=[firststep,steparray].*tmp;count=fprintf(fid,'%s\n',['Staircase step size was ',num2str(tmpa),' log units.']);count=fprintf(fid,'%s\n',['Staircase changed size immediately after reversals ',num2str(switchafterRevnum),'.']);count=fprintf(fid,'%s\n',['Staircase was 1-up, ',num2str(downcount),'-down']);count=fprintf(fid,'%s\n',['Thresholds were computed from average of last ',num2str(exptdesign.minreversals),' reversals.']);count=fprintf(fid,'%s \t %s \t %s \t %s \t %s \n','Ext. Noise Var.','Stim. Threshold Var.','SE of reversals','# Reversals','# Trials');for jj=1:exptdesign.numlocs	for kk=1:exptdesign.numnz		count=fprintf(fid,'%8.6f\t %8.6f\t %8.6f\t %i\t %i\n',screc(jj,kk).appspec,revthresh(jj,kk),revse(jj,kk),scReversals(screc(jj,kk)),scTrials(screc(jj,kk)));	end;end;count=fprintf(fid,'\n%s\n',['DATA']);count=fprintf(fid,'%s \t %s \t %s \t %s \t %s \t %s \t %s \t %s \t %s \n','trial #','locationID','conditionID','nz var','stim var','stim order','response','correct','RT(sec)');[numtrials,tmp0]=size(data);for kk=1:numtrials fprintf(fid,'%i \t %i \t %i \t %8.6f \t %8.6f \t %i \t %i \t %6.2f \t %i\n',data(kk,1:9)); endfclose(fid);cd(mainpath);disp(['data stored in text file ',datafilename]);