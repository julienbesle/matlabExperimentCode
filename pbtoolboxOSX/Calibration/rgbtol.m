function [luminance,index] = rgbtol(calmatrix,r,g,b)% function [luminance] = rgbtol(calmatrix,r,g,b)%% Finds the luminance in a calibration matrix of a particular% RGB combination. Returns the luminance and the LUT index.% If the RGB combination is not in the table, the closest value% is returned.%% April 8, 1997   JMG U of T vision lab% if the indeces are the same, there must be an index.if isequal(r,g,b)	index = find(calmatrix(:,1)==r & calmatrix(:,2)==g & calmatrix(:,3)==b);	luminance = calmatrix(index,end);% otherwise, find the closest index.else	calsize = max(size(calmatrix));	top = calsize;	bottom = 1;	RGB = [r,g,b];	loc = bottom;	done = 0;	while done ~= 1 & loc <= top		if RGB(1) == calmatrix(loc,1)			bottom = loc;			done = 1;		else			loc = loc + 1;		end	end	loc = top;	done = 0;	while done ~= 1 & loc >= bottom		if RGB(1) == calmatrix(loc,1)			top = loc;			done = 1;		else			loc = loc - 1;		end	end	index = 1;	diff = realmax;	for loc = bottom:top		tempdiff = sum(abs(calmatrix(loc,1:3)-RGB));		if tempdiff < diff			diff = tempdiff;			index = loc;		end	end	luminance = calmatrix(index,4);endreturn