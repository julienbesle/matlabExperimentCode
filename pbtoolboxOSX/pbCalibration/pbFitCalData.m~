function calFitRecord=pbFitCalData(calRecord)    caldata=calRecord.caldata;	redData=caldata(find(caldata(:,2)==0&caldata(:,3)==0),:);    greenData=caldata(find(caldata(:,1)==0&caldata(:,3)==0),:);    blueData=caldata(find(caldata(:,1)==0&caldata(:,2)==0),:);	% initial parameters	numpts = 255;	alpha = min(min(caldata(:,5)));	beta = .01;	kappa = .01;	gamma = 2;	initcoeffs = [alpha beta kappa gamma];	% fits    coeffs(1,:) = pbPelliFit(redData(:,1),redData(:,5),initcoeffs);	coeffs(2,:) = pbPelliFit(greenData(:,2),greenData(:,5),initcoeffs);	coeffs(3,:) = pbPelliFit(blueData(:,3),blueData(:,5),initcoeffs);    bigdata = loadlum(coeffs,numpts);	coeffs(4,:) = pbPelliFit([1:length(bigdata(:,end))]',bigdata(:,end),initcoeffs);	% red gun plot	fitindex=[1:.1:numpts];	fithandle = figure('NumberTitle','off','Name','Calibration Results');	subplot(2,2,1); 	rfit = pbPelliPower(coeffs(1,:),fitindex);	plot(redData(:,1),redData(:,5),'ro');hold on;	plot(fitindex,rfit,'k-');	ylabel('Luminance (cd/m^2)');	xlabel('Pixel Value');	title('Red Gun');			% green gun plot	subplot(2,2,2); 	gfit = pbPelliPower(coeffs(2,:),fitindex);	plot(greenData(:,2),greenData(:,5),'go'); hold on;	plot(fitindex,gfit,'k-');	ylabel('Luminance (cd/m^2)');	xlabel('Pixel Value');	title('Green Gun');		% blue gun plot	subplot(2,2,3); 	bfit = pbPelliPower(coeffs(3,:),fitindex);	plot(blueData(:,3),blueData(:,5),'bo'); hold on;	plot(fitindex,bfit,'k-');	ylabel('Luminance (cd/m^2)');	xlabel('Pixel Value');	title('Blue Gun');			% final calibration plot	subplot(2,2,4); 	plot([1:length(bigdata(:,end))],bigdata(:,end),'k-');	ylabel('Luminance (cd/m^2)');	xlabel('Index');	title('Look-Up Table');				drawnow;    tmpRGB=curCalibration.background;    tmp=find(bigdata(:,1)==tmpRGB(1)&bigdata(:,2)==tmpRGB(2)&bigdata(:,3)==tmpRGB(3));    lmaxminave=[bigdata(end,4),bigdata(1,4),bigdata(tmp,4)];    calFitRecord=calRecord;    calFitRecord.lmaxminave=lmaxminave;    calFitRecord.REDparams=coeffs(1,:);    calFitRecord.GREENparams=coeffs(2,:);    calFitRecord.BLUEparams=coeffs(3,:);    calFitRecord.ABKG=coeffs(4,:);    calFitRecord.calmatrix=bigdata;		end