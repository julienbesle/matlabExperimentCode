function calfuncparams=pbCalcCalFunction(lutindex,luminance,indexRange)%% function coeffs=pbCalcCalFunction(lutindex,luminance,indexRange)%	if(exist('indexRange')==0)		minindex=0;		if (max(lutindex(:))<=255)			maxindex=255;		else			maxindex=1786;		end;	else		minindex=min(indexRange(:));		maxindex=max(indexRange(:));	end;	% initial parameters	alpha = min(luminance);	beta = .01;	kappa = .01;	gamma = 2;	initcoeffs = [alpha beta kappa gamma];	% fits    coeffs = pbPelliFit(lutindex,luminance,initcoeffs);	fitindex=[minindex:maxindex];	fithandle = figure('NumberTitle','off','Name','Calibration Results');	thefit = pbPelliPower(coeffs,fitindex);	plot(lutindex,luminance,'ko');hold on;	plot(fitindex,thefit,'k-');	ylabel('Luminance (cd/m^2)');	xlabel('LUT index');	title('Best-fitting Pelli Function');				drawnow;	calfuncparams.ABKG=coeffs;	calfuncparams.lutnumber=fitindex;	calfuncparams.lumfit=thefit;     end %%    calFitRecord=calRecord;%    tmpRGB=calRecord.background;%    tmp=find(bigdata(:,1)==tmpRGB(1)&bigdata(:,2)==tmpRGB(2)&bigdata(:,3)==tmpRGB(3));%    lmaxminave=[bigdata(end,4),bigdata(1,4),bigdata(tmp,4)];%    calFitRecord.lmaxminave=lmaxminave;%    calFitRecord.REDparams=coeffs(1,:);%    calFitRecord.GREENparams=coeffs(2,:);%    calFitRecord.BLUEparams=coeffs(3,:);%    calFitRecord.ABKG=coeffs(4,:);%    calFitRecord.calmatrix=bigdata;%	%	%end%